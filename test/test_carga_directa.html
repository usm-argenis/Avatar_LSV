<!DOCTYPE html>
<html>
<head>
    <title>Test Directo de Carga GLB</title>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
            "three/examples/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/"
        }
    }
    </script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
        }
        #container {
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #2d4a2f; }
        .error { background: #4a2d2d; }
        .info { background: #2d3a4a; }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="info">
        <h2>ðŸ§ª Test de Carga GLB</h2>
        <div id="status"></div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';
        
        const statusDiv = document.getElementById('status');
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            statusDiv.appendChild(div);
            console.log(message);
        }

        // Configurar escena Three.js
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 3);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('container').appendChild(renderer.domElement);

        // Luces
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // FunciÃ³n de animaciÃ³n
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();

        // Test de carga
        async function testLoadGLB() {
            const testCases = [
                { avatar: 'Duvall', sign: 'hola', genero: 'Hombre' },
                { avatar: 'Nancy', sign: 'hola', genero: 'Mujer' },
                { avatar: 'Luis', sign: 'gracias', genero: 'Hombre' },
                { avatar: 'Nina', sign: 'adios', genero: 'Mujer' }
            ];

            for (const test of testCases) {
                addStatus(`\nðŸ“‹ Probando: ${test.avatar} - "${test.sign}"`, 'info');
                
                // Buscar en categorÃ­as
                const categorias = ['saludos', 'cortesia', 'pronombres', 'dias_semana', 'tiempo', 'preguntas', 'expresiones'];
                let found = false;
                
                for (const categoria of categorias) {
                    const path = `output/glb/${test.genero}/${categoria}/${test.sign}.glb`;
                    addStatus(`  ðŸ” Buscando: ${path}`, 'info');
                    
                    try {
                        const response = await fetch(path, { method: 'HEAD' });
                        if (response.ok) {
                            addStatus(`  âœ… Encontrado en ${categoria}`, 'success');
                            
                            // Intentar cargar el modelo
                            const loader = new GLTFLoader();
                            try {
                                const gltf = await new Promise((resolve, reject) => {
                                    loader.load(path, resolve, undefined, reject);
                                });
                                
                                addStatus(`  âœ… Modelo cargado exitosamente!`, 'success');
                                addStatus(`    - Escena cargada: ${gltf.scene ? 'SÃ­' : 'No'}`, 'info');
                                addStatus(`    - Animaciones: ${gltf.animations ? gltf.animations.length : 0}`, 'info');
                                
                                // AÃ±adir a la escena temporalmente
                                scene.add(gltf.scene);
                                setTimeout(() => scene.remove(gltf.scene), 2000);
                                
                                found = true;
                                break;
                            } catch (loadError) {
                                addStatus(`  âŒ Error al cargar modelo: ${loadError.message}`, 'error');
                            }
                        }
                    } catch (fetchError) {
                        // No existe en esta categorÃ­a, continuar
                    }
                }
                
                if (!found) {
                    addStatus(`  âŒ No se encontrÃ³ "${test.sign}" en ninguna categorÃ­a`, 'error');
                }
            }
            
            addStatus('\nâœ… Pruebas completadas', 'success');
        }

        // Ejecutar pruebas
        window.addEventListener('load', () => {
            setTimeout(testLoadGLB, 1000);
        });
    </script>
</body>
</html>
