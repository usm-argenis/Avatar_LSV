<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar Estático LSV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            overflow: hidden;
            background: #ffffff;
            border: none;
        }

        #app {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
        }

        #canvas-3d {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <canvas id="canvas-3d"></canvas>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // Obtener parámetros de URL
        const params = new URLSearchParams(window.location.search);
        const avatarName = params.get('avatar') || 'Luis';

        // Configuración
        const AVATAR_PATHS = {
            'Luis': 'output/glb/Luis/Luis.glb',
            'Duvall': 'output/glb/Duvall/Duvall.glb',
            'Nancy': 'output/glb/Nancy/Nancy.glb',
            'Carla': 'output/glb/Carla/Carla.glb',
            'Argenis': 'output/glb/Argenis/Argenis.glb'
        };

        // Variables globales
        let scene, camera, renderer, avatar;

        // Inicializar escena
        function init() {
            // Escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xffffff);

            // Cámara
            camera = new THREE.PerspectiveCamera(
                50,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 1.5, 2.1);
            camera.lookAt(0, 1.3, 1.32);

            // Renderer
            const canvas = document.getElementById('canvas-3d');
            renderer = new THREE.WebGLRenderer({ 
                canvas, 
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;

            // Luces
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);

            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight1.position.set(5, 5, 5);
            scene.add(directionalLight1);

            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.6);
            directionalLight2.position.set(-5, 3, -5);
            scene.add(directionalLight2);

            const fillLight = new THREE.DirectionalLight(0xffffff, 0.4);
            fillLight.position.set(0, -2, 5);
            scene.add(fillLight);

            // Cargar avatar
            loadAvatar(avatarName);

            // Resize
            window.addEventListener('resize', onResize);

            // Render loop
            animate();
        }

        function loadAvatar(name) {
            const loader = new GLTFLoader();
            const avatarPath = AVATAR_PATHS[name] || AVATAR_PATHS['Luis'];

            loader.load(
                avatarPath,
                (gltf) => {
                    if (avatar) {
                        scene.remove(avatar);
                    }

                    avatar = gltf.scene;
                    
                    // Posicionar avatar
                    avatar.position.set(0, 0, 0);
                    avatar.rotation.y = 0; // Mirando al frente
                    
                    // Escalar según el avatar
                    const scale = name === 'Nancy' || name === 'Carla' ? 1.0 : 1.0;
                    avatar.scale.set(scale, scale, scale);

                    scene.add(avatar);

                    console.log(`✅ Avatar ${name} cargado exitosamente`);
                },
                (progress) => {
                    const percent = (progress.loaded / progress.total) * 100;
                    console.log(`Cargando avatar: ${percent.toFixed(0)}%`);
                },
                (error) => {
                    console.error('❌ Error cargando avatar:', error);
                }
            );
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // Iniciar
        init();

        // Exponer función para cambiar avatar desde fuera
        window.changeAvatar = function(name) {
            loadAvatar(name);
        };
    </script>
</body>
</html>
