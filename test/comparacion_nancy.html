<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComparaciÃ³n Nancy - Texturas y AnimaciÃ³n</title>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
            }
        }
    </script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
        }
        
        .viewer {
            background: #2a2a2a;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .title {
            padding: 15px;
            background: #333;
            text-align: center;
            font-weight: bold;
        }
        
        .canvas-container {
            flex: 1;
            position: relative;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .controls {
            padding: 15px;
            background: #333;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        .info {
            padding: 10px;
            font-size: 12px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Nancy Original -->
        <div class="viewer">
            <div class="title">Nancy Original (Sin animaciÃ³n)</div>
            <div class="canvas-container">
                <canvas id="canvas1"></canvas>
            </div>
            <div class="info" id="info1">Cargando...</div>
        </div>
        
        <!-- Nancy con Texturas HD (sin movimiento) -->
        <div class="viewer">
            <div class="title">Nancy PERFECTO (Texturas HD)</div>
            <div class="canvas-container">
                <canvas id="canvas2"></canvas>
            </div>
            <div class="controls">
                <button onclick="playAnimation(2)">â–¶ Play</button>
            </div>
            <div class="info" id="info2">Cargando...</div>
        </div>
        
        <!-- Nancy FBX (con movimiento) -->
        <div class="viewer">
            <div class="title">Nancy FINAL (FBX â†’ Movimiento)</div>
            <div class="canvas-container">
                <canvas id="canvas3"></canvas>
            </div>
            <div class="controls">
                <button onclick="playAnimation(3)">â–¶ Play</button>
            </div>
            <div class="info" id="info3">Cargando...</div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const viewers = {};

        function setupViewer(canvasId, modelPath, infoId, viewerIndex) {
            const canvas = document.getElementById(canvasId);
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x2a2a2a);

            const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
            camera.position.set(0, 1.5, 3);

            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.outputColorSpace = THREE.SRGBColorSpace;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 5);
            scene.add(directionalLight);

            const controls = new OrbitControls(camera, canvas);
            controls.enableDamping = true;

            const loader = new GLTFLoader();
            
            loader.load(modelPath, (gltf) => {
                const model = gltf.scene;
                scene.add(model);

                // Centrar modelo
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                model.position.sub(center);

                let mixer = null;
                let animations = gltf.animations;

                if (animations && animations.length > 0) {
                    mixer = new THREE.AnimationMixer(model);
                    const clip = animations[0];
                    const action = mixer.clipAction(clip);
                    
                    viewers[viewerIndex] = {
                        scene, camera, renderer, controls, mixer, action, model
                    };
                } else {
                    viewers[viewerIndex] = {
                        scene, camera, renderer, controls, model
                    };
                }

                // Info
                let textureCount = 0;
                let hdTextureCount = 0;
                let textureDetails = [];

                model.traverse((child) => {
                    if (child.isMesh && child.material) {
                        const materials = Array.isArray(child.material) ? child.material : [child.material];
                        
                        materials.forEach(mat => {
                            if (mat.map) {
                                textureCount++;
                                const img = mat.map.image;
                                if (img.width >= 512 || img.height >= 512) {
                                    hdTextureCount++;
                                }
                                textureDetails.push(`${mat.name}: ${img.width}x${img.height}`);
                            }
                        });
                    }
                });

                const info = document.getElementById(infoId);
                info.innerHTML = `
                    âœ… Modelo cargado<br>
                    ðŸ“· Texturas: ${textureCount} (${hdTextureCount} HD)<br>
                    ðŸŽ¬ Animaciones: ${animations ? animations.length : 0}<br>
                    ${textureDetails.slice(0, 3).join('<br>')}
                `;

                animate();
            }, undefined, (error) => {
                console.error(`Error cargando ${modelPath}:`, error);
                document.getElementById(infoId).innerHTML = `âŒ Error: ${error.message}`;
            });

            function animate() {
                requestAnimationFrame(animate);
                
                const viewer = viewers[viewerIndex];
                if (viewer) {
                    if (viewer.mixer) {
                        viewer.mixer.update(0.016);
                    }
                    viewer.controls.update();
                    viewer.renderer.render(viewer.scene, viewer.camera);
                }
            }

            // Resize
            window.addEventListener('resize', () => {
                const width = canvas.clientWidth;
                const height = canvas.clientHeight;
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.setSize(width, height);
            });
        }

        window.playAnimation = function(viewerIndex) {
            const viewer = viewers[viewerIndex];
            if (viewer && viewer.action) {
                viewer.action.reset();
                viewer.action.play();
            } else {
                alert('Sin animaciÃ³n disponible');
            }
        };

        // Cargar los 3 modelos
        setupViewer('canvas1', 'output/glb/Nancy/Nancy.glb', 'info1', 1);
        setupViewer('canvas2', 'output/glb/Nancy/saludos/Nancy_resultado_hola_PERFECTO.glb', 'info2', 2);
        setupViewer('canvas3', 'output/glb/Nancy/saludos/Nancy_resultado_hola_FINAL.glb', 'info3', 3);
    </script>
</body>
</html>
