<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Verificaci√≥n: Duvall Abril Brazos Rokoko</title>
    <style>
        body { margin: 0; font-family: Arial; background: #000; color: #fff; }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 5px;
            z-index: 100;
        }
        button { margin: 5px; padding: 8px 15px; cursor: pointer; }
        #info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        #status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="status">Cargando modelo 3D...</div>
    
    <div id="controls" style="display:none;">
        <h3>üéØ Verificaci√≥n: Brazos Rokoko</h3>
        <div>
            <button id="playBtn">‚ñ∂ Play</button>
            <button id="pauseBtn">‚è∏ Pause</button>
            <button id="resetBtn">‚Üª Reset</button>
        </div>
        <div>
            <label>Frame: <span id="frameNum">0</span> / <span id="totalFrames">0</span></label>
            <input type="range" id="frameSlider" style="width: 300px;" min="0" max="1000" value="0">
        </div>
        <div>
            <label><input type="checkbox" id="wireframe"> Wireframe</label>
            <label><input type="checkbox" id="showSkeleton" checked> Esqueleto</label>
        </div>
    </div>

    <div id="info" style="display:none;">
        <div id="modelInfo"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, model, mixer, clock, skeleton;
        let isPlaying = false;
        let action = null;

        init();
        animate();

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);

            // Camera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.5, 3);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 1, 0);
            controls.update();

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 10, 7.5);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // Grid
            const gridHelper = new THREE.GridHelper(10, 10);
            scene.add(gridHelper);

            // Clock
            clock = new THREE.Clock();

            // Load model
            const loader = new THREE.GLTFLoader();
            loader.load(
                'output/Duvall_abril_BRAZOS_FINAL.glb',
                function(gltf) {
                    model = gltf.scene;
                    scene.add(model);

                    // Setup animation
                    if (gltf.animations && gltf.animations.length > 0) {
                        mixer = new THREE.AnimationMixer(model);
                        action = mixer.clipAction(gltf.animations[0]);
                        action.play();
                        
                        const duration = gltf.animations[0].duration;
                        const fps = 30;
                        const totalFrames = Math.floor(duration * fps);
                        
                        document.getElementById('totalFrames').textContent = totalFrames;
                        document.getElementById('frameSlider').max = totalFrames;
                        
                        document.getElementById('modelInfo').innerHTML = `
                            <strong>Modelo cargado:</strong> Duvall_abril_BRAZOS_FINAL.glb<br>
                            <strong>Animaciones:</strong> ${gltf.animations.length}<br>
                            <strong>Duraci√≥n:</strong> ${duration.toFixed(2)}s<br>
                            <strong>Frames:</strong> ${totalFrames}<br>
                            <strong>Estado:</strong> <span style="color:#0f0">‚úì BRAZOS COMBINADOS EXITOSAMENTE</span>
                        `;
                    }

                    // Add skeleton helper
                    model.traverse((node) => {
                        if (node.isSkinnedMesh) {
                            skeleton = new THREE.SkeletonHelper(model);
                            skeleton.visible = true;
                            scene.add(skeleton);
                        }
                    });

                    document.getElementById('status').style.display = 'none';
                    document.getElementById('controls').style.display = 'block';
                    document.getElementById('info').style.display = 'block';
                    isPlaying = true;
                },
                function(xhr) {
                    const percent = (xhr.loaded / xhr.total * 100).toFixed(0);
                    document.getElementById('status').textContent = `Cargando: ${percent}%`;
                },
                function(error) {
                    document.getElementById('status').innerHTML = 
                        `<span style="color:#f00">‚ùå Error al cargar: ${error.message}</span>`;
                    console.error(error);
                }
            );

            // Event listeners
            document.getElementById('playBtn').addEventListener('click', () => {
                if (action) {
                    action.paused = false;
                    isPlaying = true;
                }
            });

            document.getElementById('pauseBtn').addEventListener('click', () => {
                if (action) {
                    action.paused = true;
                    isPlaying = false;
                }
            });

            document.getElementById('resetBtn').addEventListener('click', () => {
                if (action) {
                    action.time = 0;
                    if (mixer) mixer.update(0);
                }
            });

            document.getElementById('frameSlider').addEventListener('input', (e) => {
                if (action && mixer) {
                    const frame = parseInt(e.target.value);
                    action.time = frame / 30;
                    action.paused = true;
                    isPlaying = false;
                    mixer.update(0);
                }
            });

            document.getElementById('wireframe').addEventListener('change', (e) => {
                if (model) {
                    model.traverse((node) => {
                        if (node.isMesh) {
                            node.material.wireframe = e.target.checked;
                        }
                    });
                }
            });

            document.getElementById('showSkeleton').addEventListener('change', (e) => {
                if (skeleton) {
                    skeleton.visible = e.target.checked;
                }
            });

            window.addEventListener('resize', onWindowResize);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (mixer && isPlaying) {
                const delta = clock.getDelta();
                mixer.update(delta);
                
                if (action) {
                    const frame = Math.floor(action.time * 30);
                    document.getElementById('frameNum').textContent = frame;
                    document.getElementById('frameSlider').value = frame;
                }
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
